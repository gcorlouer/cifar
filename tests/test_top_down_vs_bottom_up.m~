    %% Test Compare top down vs bottom up GC
nsim = 100;
z = zeros(nsim,1);
pval = zeros(nsim,1);
for i=1:nsim
    input_parameters;
    morder = 3;
    specrad = 0.9;
    m = 300;
    N = 56;
    tsdim = 10;
    %% Simulate time series

    [X,var_coef, E, connectivity_matrix] = var_simulation(tsdim, 'ntrials',N, 'nobs',m,...
        'morder',morder);

    %% Estimate single trial pcgc

    F = ts_to_single_pGC(X,'morder',morder, 'regmode', regmode);

    %% Get top down and bottom up GC

    R_idx = randi([0 10]);
    F_idx = [5 6 7];
    nR = length(R_idx);
    nF = length(F_idx); 

    F_td = F(R_idx, F_idx,:);
    F_td = reshape(F_td, numel(F_td),1);

    F_bu = F(F_idx, R_idx,:);
    F_bu = reshape(F_bu, numel(F_bu),1);


    %% Compare top down and bottom up GC

    z(i) = mann_whitney(F_bu,F_td);
    pval(i) = erfc(abs(z(i))/sqrt(2));
    zcrit = sqrt(2)*erfcinv(alpha);
    if z(i)>zcrit
        fprintf('Top down dominates')
    elseif z(i)<-zcrit
        fprintf('Bottom up dominate')
    else
        fprintf('No direction dominates')
    end
end

zmean = mean(z);
if zmean>zcrit
        fprintf('Top down dominates')
elseif zmean<-zcrit
    fprintf('Bottom up dominate')
else
    fprintf('No direction dominates')
end
%% Compare top down and bottom up GC with pairs


